#
# Copyright 2021-2022 The OpenSSL Project Authors. All Rights Reserved.
#
# Licensed under the Apache License 2.0 (the "License").  You may not use
# this file except in compliance with the License.  You can obtain a copy
# in the file LICENSE in the source distribution or at
# https://www.openssl.org/source/license.html

# Tests start with one of these keywords
#       Cipher Decrypt Derive Digest Encoding KDF MAC PBE
#       PrivPubKeyPair Sign Verify VerifyRecover
# and continue until a blank line. Lines starting with a pound sign are ignored.

Title = KBKDF tests

# Test vectors taken from
# https://csrc.nist.gov/CSRC/media/Projects/
#    Cryptographic-Algorithm-Validation-Program/documents/KBKDF800-108/CounterMode.zip

# [PRF=CMAC_AES128]
# [CTRLOCATION=BEFORE_FIXED]
# [RLEN=16_BITS]

# COUNT=0
# L = 128
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES128
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:30ec5f6fa1def33cff008178c4454211
Ctrl.hexinfo = hexinfo:c95e7b1d4f2570259abfc05bb00730f0284c3bb9a61d07259848a1cb57c81d8a6c3382c500bf801dfc8f70726b082cf4c3fa34386c1e7bf0e5471438
Output = 00018fff9574994f5c4457f461c7a67e

# COUNT=10
# L = 256
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES128
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:145c9e9365041f075ebde8ce26aa2149
Ctrl.hexinfo = hexinfo:0d39b1c9c34d95b5b521971828c81d9f2dbdbc4af2ddd14f628721117e5c39faa030522b93cc07beb8f142fe36f674942453ec5518ca46c3e6842a73
Output = 8a204ce7eab882fae3e2b8317fe431dba16dabb8fe5235525e7b61135e1b3c16

# COUNT=20
# L = 160
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES128
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:6f3f8cbf40d2a694274cfa2eb2f265a3
Ctrl.hexinfo = hexinfo:e7b88baa4a2c22b3d78f41d509996c95468c8cb834b035dd5e09e0a455da254b8b5687a1433861751d2dd603f69b2d4ba4ae47776335d37c98b44b4b
Output = d147f1c78121c583cbcb9d4b0d3767a357bd7232

# COUNT=30
# L = 320
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES128
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:5e534bea459e54c58a6942abfd4df8ab
Ctrl.hexinfo = hexinfo:e9a5cc15d223aaa74abd122983b2a10512199b9cc87663fd8a62d417cef53770264fc51f683890fe42da2df7be0f60898c5b09d5c4932137b6b1e06e
Output = 92480eb4860123ceda76f1e6bf2668520bea49ed72bb900ae50725bb8cfcdb733af1a9de71fe1af5


# [PRF=CMAC_AES192]
# [CTRLOCATION=BEFORE_FIXED]
# [RLEN=16_BITS]

# COUNT=0
# L = 128
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES192
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:d7e8eefc503a39e70d931f16645958ad06fb789f0cbc518b
Ctrl.hexinfo = hexinfo:b10ea2d67904a8b3b7ce5eef7d9ee49768e8deb3506ee74a2ad8dd8661146fde74137a8f6dfc69a370945d15335e0d6403fa029da19d34140c7e3da0
Output = 95278b8883852f6676c587507b0aa162

# COUNT=10
# L = 256
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES192
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:5e6695d7c3f5b156c7b457c8c2b801ba2ae30c9c8a36ee61
Ctrl.hexinfo = hexinfo:1406756f40efb8e29d5455d2da4bf1993b3c3901d67ec90934895f5de7845f573ae8a0dc8a6ad77d80da29e81329440d61d63dda8eaa7851bc7a172d
Output = 72046d5eed909f6ab25810ead446ace7422fd87e6bd496ff2e84b115b8e0d27e

# COUNT=20
# L = 160
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES192
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:e3b88f40c9974410955820a8f8392701e9c67cc6efd3b0ff
Ctrl.hexinfo = hexinfo:a520f36b6b60dfce34dc1d1f6b16132efa82566efa49f3140113fbc59e309c40db42962c06123721f122f433fa417ce3319bca9c58b4184fd8c7be8f
Output = 134b6236a80c257591cc1437ab007b3fa4bd7191

# COUNT=30
# L = 320
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES192
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:51574d47f2f1d202a30252823b52ba7858b729d5ed4c92f7
Ctrl.hexinfo = hexinfo:0819c17dd3f9a68493a958c46152d04ba450043908a0016b99cc124d5e75b0d11e7c26f27365609c110eee7f8baa88a7d99fecc690e617150f93bd6c
Output = c46db4cd822e9841408fba79932d6c748bc7ab17421ed1ad188aed327c2a0d694e380c0cade8b37f

# [PRF=CMAC_AES256]
# [CTRLOCATION=BEFORE_FIXED]
# [RLEN=16_BITS]

# COUNT=0
# L = 128
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES256
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:4df60800bf8e2f6055c5ad6be43ee3deb54e2a445bc88a576e111b9f7f66756f
Ctrl.hexinfo = hexinfo:962adcaf12764c87dad298dbd9ae234b1ff37fed24baee0649562d466a80c0dcf0a65f04fe5b477fd00db6767199fa4d1b26c68158c8e656e740ab4d
Output = eca99d4894cdda31fe355b82059a845c

# COUNT=10
# L = 256
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES256
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:4c30b96d9beff5cc3c37527694eeec8207fae2c13ef295556919a7a46e5b90c1
Ctrl.hexinfo = hexinfo:86e1ad34bd7a998281a822129a23102f799812864cf5349f3f21cec7729f83ad8c8aa6517fafcc9521cde887686629048159ed3f15c01408984f547e
Output = 815fe232e0e89f7eeaa87c3ba5007694a43c1577657ccb3018076c5a5c035d95

# COUNT=20
# L = 160
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES256
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:e508ce78aca2cc50c80a6cbdb2b178f8ee5e315dad71ddfa700eb6cf503239b3
Ctrl.hexinfo = hexinfo:28c47ddd23d349e3b30bf97975c5fa591f2158e001dae3faa154d93c615c89fc7449c901a2585e618f68a0b2cbd3f35f53424d5ea015cbf7e8e09f68
Output = 6bc69b4c11aa7c04ac3c03baa44daeac4a047992

# COUNT=30
# L = 320
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.cipher = cipher:AES256
Ctrl.mac = mac:CMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:ee0a0f88b3b441826264de7a31b890a66edf7c2a28d0286eab285846b586fb8e
Ctrl.hexinfo = hexinfo:1ea9771ab763056260d885073e80e835e20e5d7ca9659fdf5dd3b7f2ae6286608f8bc7a6728e41346c55544942b1bf06642fb6a6738fb5b7f0128f9c
Output = 5484f170b6602b505e9e6ccffccf2262b55c3554728244bba94daff0adbc619400b33f38013a2293

# [PRF=HMAC_SHA1]
# [CTRLOCATION=BEFORE_FIXED]
# [RLEN=16_BITS]

# COUNT=0
# L = 128
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA1
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:a510fe5ad1640d345a6dbba65d629c2a2fedd1ae
Ctrl.hexinfo = hexinfo:9953de43418a85aa8db2278a1e380e83fb1e47744d902e8f0d1b3053f185bbcc734d12f219576e75477d7f7b799b7afed1a4847730be8fd2ef3f342e
Output = c00707a18c57acdb84f17ef05a322da2

# COUNT=10
# L = 256
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA1
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:abec6c894ae9df32e5afdf5d06a0434e8940ca71
Ctrl.hexinfo = hexinfo:9a6574a0ea1123ab9580906f8a2c4a0ecba9a8a84079c37a6e283ad4d4e957c3d16db66ae4be99e688b221c359a8dd2505868beb6a49fd7ce6c35df4
Output = 5b37675aec199c7d08435ef6321cf6235c12453a4530072d4a73ba0ad34634a5

# COUNT=20
# L = 160
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA1
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:df4e835a2f201a3d0f840eab38a18adf72adf9eb
Ctrl.hexinfo = hexinfo:84c6ca541d24a8b419037b9657ee4e0d5ef96d8b198355940a30b09bf8784e81d3b93558de21c46f04aec4afd610c3b230d17473c80b47b5004955e7
Output = 1202915544844b1f913caab512c582735bf76fed

# COUNT=30
# L = 320
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA1
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:cbe1d2895640dcd1545e60e04ce9d995707ec539
Ctrl.hexinfo = hexinfo:c80d735ec5fd0bf811a4a71c55e99373f83f4111194ec24a8e9fe24ef03f56ed15b4e135e02488d96dba8c0d60c26592df55a492691cf3b7eced40d1
Output = 1fd5a183be95c2d909deed31d686417d5c08bb88e6f75b150df330c8e7703bb8ccdffacb3e9ee3ff

# [PRF=HMAC_SHA256]
# [CTRLOCATION=BEFORE_FIXED]
# [RLEN=16_BITS]

# COUNT=0
# L = 128
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA256
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:743434c930fe923c350ec202bef28b768cd6062cf233324e21a86c31f9406583
Ctrl.hexinfo = hexinfo:9bdb8a454bd55ab30ced3fd420fde6d946252c875bfe986ed34927c7f7f0b106dab9cc85b4c702804965eb24c37ad883a8f695587a7b6094d3335bbc
Output = 19c8a56db1d2a9afb793dc96fbde4c31

# COUNT=10
# L = 256
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA256
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:365592398d23d31f2cac8bf6211f1ad5f52608efcdc5997b144ea6ded3866cf6
Ctrl.hexinfo = hexinfo:07dce524556d3f68d2d91d4c15c9c6212635e0df1aef54938490db46f98737064d6a5624d7f938c263af01e632c45d9fe7a871b67f7d4bf110796eb4
Output = 5624c6911dc1b08e090c8c95347adf17895b696aae211932cde3ec8227fcbea8

# COUNT=20
# L = 160
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA256
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:c104e187e344668997b7bd9c8cdf097320518dd7dbcb541c414418b55b58cbb2
Ctrl.hexinfo = hexinfo:32f6bd59840c61909f2f92f98f54bd238083577e33c3d071c1abe4c694bd87c1ad235eb9a2d272b3dc67c955574d5e6cad84615120476d6e7e04f51f
Output = 1b5d9e60aa909aeb973e76d9bf6be208327bb096

# COUNT=30
# L = 320
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA256
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:d4349c26108719debacc04e166a09063ffb5e17bcbaf8738dc2618aa7d1e97ae
Ctrl.hexinfo = hexinfo:da1f5ed45ead428689b0ecca9dbc2569e76953cda0df085499cca6d5949d8995e1e42bbdc94b0dd78c164867c364a64c894de85294ad89d267ff443d
Output = 00550ae0f29a2373269af175e7f829ec32c3d05099a39f8c0e02caa00b68afb7457669334383ffb2

# [PRF=HMAC_SHA384]
# [CTRLOCATION=BEFORE_FIXED]
# [RLEN=16_BITS]

# COUNT=0
# L = 128
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA384
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:26ef897e4b617b597f766ec8d8ccf44c543e790a7d218f029dcb4a3695ae2caccce9d3e935f6741581f2f53e49cd46f8
Ctrl.hexinfo = hexinfo:bc2c728f9dc6db426dd4e85fdb493826a31fec0607644209f9bf2264b6401b5db3004c1a76aa08d93f08d3d9e2ba434b682e480004fb0d9271a8e8cd
Output = a43d31f07f0ee484455ae11805803f60

# COUNT=10
# L = 256
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA384
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:269cce234dd4783067ceaa04a70deb1c9700acf705548495767c22f78493851ca9c699077a002874caacb760106016c6
Ctrl.hexinfo = hexinfo:f64bfb4bdaac81b5801d2f9f08bc2e4d009990b67290fd49b3730c3a145696447aceae6a82f7508a19c396a548c9c33d943dab82b2538c18b8eee871
Output = ab4182261c5d9c0d23a26477f14a507dd7f5e9550d04f48de29e644ed55f3406

# COUNT=20
# L = 160
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA384
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:ec71de96c9520386f9d11bebe474bae0c0549e2b2e8fda6b2336050ee3acbec38bc57d56e6422d3cd493ead69772a059
Ctrl.hexinfo = hexinfo:4313d1efba21dded84ce12bf80b1be54400619d3bb1987f18bf85400e335103969e77c819a5360cf1dd3f4addb6b8eec0199508c75adfe2cfc067dc8
Output = 8e37ecc86dcb5ee7cf48d8a07f06c47cdce624cc

# COUNT=30
# L = 320
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA384
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:afe2d3a4746792908aca8ece67ba8562382000b4e26122414b3ef2e120511bae68448955cf186be87caf69eaced47e87
Ctrl.hexinfo = hexinfo:1f6dd0b17fed7f479c4f62927291a95292a4e232441c30ffcaa1d347543e50db939360bb37976eacb911f76c38ad8cce12a0c263875bbcd7f6011ffd
Output = 17b671ca433cea81384b03b69c26a55257085cdfa48e6d8529431464bd439a881de560294afb0073

# [PRF=HMAC_SHA512]
# [CTRLOCATION=BEFORE_FIXED]
# [RLEN=16_BITS]

# COUNT=0
# L = 128
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA512
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:bb0c55c7201ceb2e1369a6c49e2cdc1ae5e4cd1d64638105072c3a9172b2fa6a127c4d6d55132585fb2644b5ae3cf9d347875e0d0bf80945eaabef3b4319605e
Ctrl.hexinfo = hexinfo:89bf925033f00635c100e2c88a98ad9f08cd6a002b934617d4ebfffc0fe9bca1d19bd942da3704da127c7493cc62c67f507c415e4cb67d7d0be70005
Output = 05efd62522beb9bfff6492ecd24501a7

# COUNT=10
# L = 256
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA512
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:393eb889e9c2f251b95aa147d53e4cd029fd0391110be9c6b2f8ba32857864847c448a9a591686de88da7486d0a0f0f8c927560fa8f79c30e66a7efaacaa638f
Ctrl.hexinfo = hexinfo:116bf7f9e5eb884c86cd0d3a2b33d41de7735677e6bd727e83fbde5c8113de56bf84c9f80610db760ae2df73f4f0db9df0cc1655ea9bc98bb06beeda
Output = 212e4e4057a6871e166e7563205833bc7f01e86c724b6a61166d9311c55b5044

# COUNT=20
# L = 160
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA512
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:eeec4383a808fae57f24a7a5eb6157cca66483a613590c89ed39f59617ea97fcfa7cdfc83ba8140fa0d8542263d6423a9bcca70e11addb7a646f194ff0878cac
Ctrl.hexinfo = hexinfo:b2565a20171eef1eaa04728e6c369405b251062bbd0a2b9171c8c6fedf0ff783691db787f153bbf5167301808f768a03df0deec99f2b9efb90cab571
Output = 4f31b7bcd54c74d8a7d31aca187b8736f0a59db7

# COUNT=30
# L = 320
KDF = KBKDF
Ctrl.mode = mode:COUNTER
Ctrl.digest = digest:SHA512
Ctrl.mac = mac:HMAC
Ctrl.use-l = use-l:0
Ctrl.use-separator = use-separator:0
Ctrl.hexkey = hexkey:62690d8ef259d175911d8eb52a331af29a8e3b797c4b315a67fa5cd1b00e585b2f7d97341284d0fcaa15a080732f7958e3b33e938e730623d1e651dbea9b2233
Ctrl.hexinfo = hexinfo:266535b58de26ed62f936bc7147c8c3b31ee0c1bb92c5ef63699ac7225e01cec5afd2e6e39cf095882324c7dc94b0daa2befc50f790da0547d7c6184
Output = 9336a88737d9ae01b5c43be5789c8545689557aad295ea3c03d2a2e0143603365fea1656175c20bf
